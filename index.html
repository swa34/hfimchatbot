<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive LLM API Cost Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <!-- Chat backend config -->
    <script>
        window.API_URL = " https://net-mainstream-airfare-greatest.trycloudflare.com/chat"; // ALWAYS END WITH /CHATchange if tunnel changes
        window.API_KEY = "super-secret"; // must match CHATBOT_API_KEY in your Node server .env
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 450px;
            }
        }

        .nav-link {
            transition: color 0.3s ease;
        }

        .nav-link.active,
        .nav-link:hover {
            color: #0d9488;
        }

        .phase-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            padding: 0 1.5rem;
        }

        .phase-content.open {
            max-height: 500px;
            /* Adjust as needed for content */
            padding: 1.5rem 1.5rem;
        }

        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #0d9488;
            cursor: pointer;
            border-radius: 50%;
        }

        .slider-thumb::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #0d9488;
            cursor: pointer;
            border-radius: 50%;
        }

        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }

        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            width: 280px;
            background-color: #1e293b;
            color: #fff;
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            font-size: 0.75rem;
            line-height: 1.25;
        }

        .has-tooltip:hover .tooltip {
            opacity: 1;
        }

        /* Chat styles */
        #hfim-box {
            border: 1px solid #cbd5e1;
            padding: 10px;
            width: 100%;
            max-width: 420px;
            background: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        #hfim-msgs {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            padding: 6px;
            margin-bottom: 8px;
            background: #f8fafc;
            border-radius: 0.375rem;
            display: flex;
            flex-direction: column;
            /* Stack messages vertically */
        }

        .hfim-msg {
            margin: 8px 4px;
            display: flex;
            align-items: flex-end;
        }

        .hfim-msg.user {
            justify-content: flex-end;
            /* Align to right */
        }

        .hfim-msg.bot {
            justify-content: flex-start;
            /* Align to left */
        }

        .hfim-msg .bubble {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 70%;
            word-wrap: break-word;
            font-size: 0.9rem;
            display: inline-block;
            /* This makes it fit content */
        }

        .hfim-msg.user .bubble {
            background-color: #0d9488;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .hfim-msg.bot .bubble {
            background-color: #f1f5f9;
            color: #0f172a;
            border-bottom-left-radius: 4px;
        }

        /* Loading spinner styles */
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: #f1f5f9;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            margin: 8px 4px;
            align-self: flex-start;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #94a3b8;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
                opacity: 0.7;
            }

            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .hfim-msg.bot .bubble {
            white-space: pre-wrap;
            /* Preserves line breaks and wraps long lines */
            text-align: left;
            /* Ensures left alignment for better readability */
            line-height: 1.6;
            /* Better line spacing */
            font-size: 0.95rem;
            /* Slightly larger for readability */
        }

        /* Styling for lists within bot messages */
        .hfim-msg.bot .bubble ul,
        .hfim-msg.bot .bubble ol {
            margin: 0.5em 0;
            padding-left: 1.5em;
        }

        .hfim-msg.bot .bubble li {
            margin: 0.25em 0;
        }

        /* Make bold text stand out */
        .hfim-msg.bot .bubble strong {
            color: #0f766e;
            font-weight: 600;
        }

        /* Add some spacing between line breaks */
        .hfim-msg.bot .bubble br+br {
            display: block;
            height: 0.5em;
        }
    </style>
</head>

<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-teal-700">LLM Cost Analyzer</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#summary"
                            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700">Summary</a>
                        <a href="#roadmap"
                            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700">Roadmap</a>
                        <a href="#costs" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700">Cost
                            Engine</a>
                        <a href="#database-analysis"
                            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700">Database Costs</a>
                        <a href="#strategy"
                            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700">Strategy</a>
                        <a href="#integration"
                            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700">Integration</a>
                        <a href="#budget"
                            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700">Budget</a>
                        <a href="#chatbot"
                            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-teal-700">Chatbot</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <section id="summary" class="mb-16 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Strategic & Financial Analysis
                </h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">An interactive guide to the costs and
                    strategy for implementing an LLM-powered chatbot for student engagement.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <dt class="text-sm font-medium text-slate-500">Core Recommendation</dt>
                    <dd class="mt-1 text-2xl font-semibold tracking-tight text-teal-600">Pilot with GPT-4o-mini & RAG
                    </dd>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <dt class="text-sm font-medium text-slate-500">Total Development Effort</dt>
                    <dd class="mt-1 text-2xl font-semibold tracking-tight text-slate-900">~500+ Man-Hours</dd>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <dt class="text-sm font-medium text-slate-500">Est. Monthly API Cost (Moderate)</dt>
                    <dd class="mt-1 text-2xl font-semibold tracking-tight text-slate-900">~$6.00</dd>
                </div>
            </div>
            <div class="mt-8 bg-teal-50 border-l-4 border-teal-500 text-teal-800 p-6 rounded-lg shadow-sm">
                <h3 class="font-bold mb-2">Executive Summary</h3>
                <p class="text-sm md:text-base">This analysis confirms the financial viability of launching an LLM
                    chatbot. Recent market shifts have made powerful models incredibly affordable, reducing projected
                    operational costs by over 90%. The recommended "start smart, scale smart" approach leverages a
                    commercial API and a Retrieval-Augmented Generation (RAG) architecture. This strategy maximizes
                    accuracy and minimizes costs, making the project a low-risk, high-impact strategic investment in
                    student engagement.</p>
            </div>
        </section>

        <section id="roadmap" class="mb-16 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Project Roadmap & Team</h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">The project is not about building an
                    LLM, but integrating one. Below is the phase-by-phase development lifecycle and the lean team
                    required to execute it.</p>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 md:p-8 mb-12">
                <h3 class="text-xl font-bold text-center mb-8">Development Lifecycle (~410+ Hours)</h3>
                <div id="timeline-container" class="space-y-4">
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <h3 class="text-xl font-bold text-center mb-8">Required Team Composition (3-5 Specialists)</h3>
                <div id="team-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">
                </div>
            </div>
        </section>

        <section id="costs" class="mb-16 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">The Cost Engine</h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">Operational API costs are the primary
                    recurring expense. Use this interactive calculator to explore how different models and usage
                    scenarios impact your monthly budget. The results are based on the latest market pricing.</p>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 space-y-6">
                        <div>
                            <label for="model-select" class="block text-sm font-medium text-slate-700">Select LLM
                                Model</label>
                            <select id="model-select"
                                class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                            </select>
                        </div>
                        <div>
                            <label for="visitor-slider" class="block text-sm font-medium text-slate-700">Daily Website
                                Visits: <span id="visitor-value" class="font-bold text-teal-600">500</span></label>
                            <input id="visitor-slider" type="range" min="100" max="5000" value="500" step="100"
                                class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                        </div>
                        <div>
                            <label for="engagement-slider" class="block text-sm font-medium text-slate-700">Chatbot
                                Engagement Rate: <span id="engagement-value"
                                    class="font-bold text-teal-600">40%</span></label>
                            <input id="engagement-slider" type="range" min="5" max="100" value="40" step="5"
                                class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg text-center">
                            <p class="text-sm text-slate-600">Projected Monthly API Cost</p>
                            <p id="monthly-cost" class="text-4xl font-bold text-slate-800">$6.00</p>
                        </div>
                    </div>
                    <div class="lg:col-span-2">
                        <div class="chart-container">
                            <canvas id="cost-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="database-analysis" class="mb-16 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Interactive Vector Database
                    Cost Analysis</h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">Use the slider to model costs for
                    different knowledge base sizes. The analysis shows how costs scale beyond free tiers into standard
                    paid plans.</p>
                <!-- NEW LINK TO VECTORDB.HTML -->
                <p class="mt-6">
                    <a href="vectorDB.html" target="_blank"
                        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500">
                        Learn More: What is a Vector Database?
                        <svg class="ml-2 -mr-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                            fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd"
                                d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"
                                clip-rule="evenodd" />
                            <path fill-rule="evenodd"
                                d="M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </a>
                </p>
            </div>
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8 space-y-8">

                <div>
                    <label for="db-size-slider" class="block text-sm font-medium text-slate-700 mb-2">Knowledge Base
                        Size: <span id="db-size-value" class="font-bold text-teal-600">5</span> GB</label>
                    <input id="db-size-slider" type="range" min="1" max="50" value="5" step="1"
                        class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                </div>

                <div>
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Projected Annual Costs by Provider</h3>
                    <div class="overflow-x-auto rounded-lg border border-slate-200">
                        <table class="min-w-full divide-y divide-slate-200">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th scope="col"
                                        class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">
                                        Select</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                        Provider</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                        Est. Annual Cost</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                        Key Cost Justification</th>
                                </tr>
                            </thead>
                            <tbody id="db-cost-table" class="bg-white divide-y divide-slate-200 text-sm">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Strategic Recommendation</h3>
                    <div id="db-recommendation"
                        class="bg-teal-50 border-l-4 border-teal-500 text-teal-800 p-6 rounded-lg shadow-sm">
                    </div>
                </div>

            </div>
        </section>

        <section id="strategy" class="mb-16 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">The Core Strategic Decision
                </h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">To ensure accuracy and relevance, the
                    LLM needs your institution's specific knowledge. The choice between RAG and Fine-Tuning is critical
                    for cost, accuracy, and long-term agility.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white border-2 border-teal-500 rounded-xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold text-slate-900 mb-4">Retrieval-Augmented Generation (RAG)</h3>
                    <p class="text-sm text-teal-600 font-semibold mb-4">RECOMMENDED STRATEGY</p>
                    <p class="mb-6 text-slate-600">Provides the LLM with relevant information "just-in-time" from your
                        knowledge base to answer questions. It doesn't retrain the model, it informs it.</p>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-green-500 text-2xl mr-3">&#10003;</span>
                            <div><strong class="text-slate-800">High Accuracy:</strong> Responses are grounded in your
                                official documents, minimizing factual errors or "hallucinations."</div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 text-2xl mr-3">&#10003;</span>
                            <div><strong class="text-slate-800">Cost-Effective:</strong> Avoids expensive training runs.
                                You only pay for standard API calls.</div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 text-2xl mr-3">&#10003;</span>
                            <div><strong class="text-slate-800">Agile & Maintainable:</strong> Updating the chatbot's
                                knowledge is as simple as editing a source document. Fast, easy, and free.</div>
                        </li>
                        <!-- NEW LINK TO RAG_EXPLANATION.HTML -->
                        <p class="mt-6">
                            <a href="rag_explanation.html" target="_blank"
                                class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500">
                                Learn More: What is RAG?
                                <svg class="ml-2 -mr-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                    fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd"
                                        d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"
                                        clip-rule="evenodd" />
                                    <path fill-rule="evenodd"
                                        d="M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"
                                        clip-rule="evenodd" />
                                </svg>
                            </a>
                        </p>

                    </ul>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6 opacity-70">
                    <h3 class="text-2xl font-bold text-slate-900 mb-4">Model Fine-Tuning</h3>
                    <p class="text-sm text-amber-600 font-semibold mb-4">HIGHER COST & COMPLEXITY</p>
                    <p class="mb-6 text-slate-600">Permanently retrains the base LLM on a custom dataset of your
                        institution's Q&A pairs, creating a specialized model variant.</p>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-red-500 text-2xl mr-3">&#10007;</span>
                            <div><strong class="text-slate-800">High Upfront Cost:</strong> Requires extensive data
                                preparation and expensive computational training runs (thousands of dollars).</div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-red-500 text-2xl mr-3">&#10007;</span>
                            <div><strong class="text-slate-800">Higher Operational Cost:</strong> API calls to
                                custom-tuned models are more expensive than base models.</div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-red-500 text-2xl mr-3">&#10007;</span>
                            <div><strong class="text-slate-800">Slow to Update:</strong> The model is a static snapshot.
                                Updating it requires repeating the entire costly and slow fine-tuning process.</div>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="integration" class="mb-16 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Integration Strategy</h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">A future-proof "decoupled"
                    architecture makes integration into AEM and migration to WordPress simple and efficient.</p>
            </div>
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <h3 class="text-xl font-bold text-center mb-4">Decoupled Architecture Overview</h3>
                <p class="text-center text-slate-600 max-w-2xl mx-auto mb-8">The core principle is that your website
                    (AEM/WordPress) is separate from the chatbot's "brain." The website displays a simple chat widget,
                    which communicates with a standalone chatbot service. This makes the chatbot portable and easy to
                    maintain.</p>
                <div class="code-block text-center text-sm leading-6">
                    <pre>
 USER'S BROWSER
|
+------------------+     +--------------------------------+
| AEM/WordPress    |     | YOUR STANDALONE CHATBOT SVC    |
| (Chat Widget UI) |----->| (Hosted on AWS, Azure, etc.)   |
+------------------+     +--------------------------------+
     AJAX Request           |                          |
                            V                          V
                       +----------------+   +------------------+
                       | RAG System /   |   | External LLM API |
                       | Vector DB      |   | (OpenAI, Google) |
                       +----------------+   +------------------+
</pre>
                </div>
                <div class="mt-12">
                    <h3 class="text-xl font-bold text-center mb-8">Step-by-Step Integration Plan</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-semibold mb-2">Step 1 & 2: Build the Service & Widget</h4>
                            <p class="text-slate-600 text-sm mb-4">Develop the chatbot back-end service (the "brain")
                                and the front-end chat widget (the "face") as two separate, independent projects. This
                                is the main development effort.</p>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold mb-2">Step 3: Integrate into AEM</h4>
                            <p class="text-slate-600 text-sm mb-4">Create a simple AEM component that adds the following
                                two lines to your page templates, loading the widget.</p>
                            <div class="code-block">
                                &lt;div id="chatbot-root"&gt;&lt;/div&gt;
                                &lt;script src="https://your-cdn.com/chatbot-widget.js"&gt;&lt;/script&gt;
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <h4 class="text-lg font-semibold mb-2">Step 4: Migrate to WordPress (Future)</h4>
                            <p class="text-slate-600 text-sm mb-4">This step requires no changes to the chatbot itself.
                                Simply replicate Step 3 in WordPress. The easiest method is to go to <code
                                    class="text-xs bg-slate-200 p-1 rounded">Appearance &gt; Theme File Editor</code>,
                                open <code class="text-xs bg-slate-200 p-1 rounded">footer.php</code>, and paste the
                                same two lines of code from the AEM component before the closing <code
                                    class="text-xs bg-slate-200 p-1 rounded">&lt;/body&gt;</code> tag.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CHATBOT SECTION -->
        <section id="chatbot" class="mb-16 scroll-mt-24">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">HFIM Chatbot Demo</h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">Ask questions about the University of
                    Georgia Hospitality & Food Industry Management program.</p>
            </div>
            <div class="flex justify-center">
                <div id="hfim-box">
                    <div id="hfim-msgs"></div>
                    <div class="flex gap-2">
                        <input id="hfim-input"
                            class="flex-1 border border-slate-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"
                            placeholder="Ask about HFIM..." />
                        <button id="hfim-send"
                            class="px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded-md text-sm">Send</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="budget" class="scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">First-Year Budget Outlook</h2>
                <p class="mt-4 text-lg leading-8 text-slate-600 max-w-3xl mx-auto">This summary consolidates the total
                    estimated investment for the first year, combining one-time development with recurring operational
                    costs.</p>
            </div>
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="text-xl font-bold mb-4">Cost Component Breakdown</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="dev-rate-input" class="block text-sm font-medium text-slate-700">
                                    Blended Hourly Rate for Development ($)
                                    <span class="relative inline-block align-middle has-tooltip ml-1">
                                        <span class="font-bold text-teal-600">(?)</span>
                                        <span class="tooltip">This is an average hourly cost across all specialists
                                            (engineers, developers, analysts). Adjust this single rate to model
                                            different labor cost scenarios for the project.</span>
                                    </span>
                                </label>
                                <input type="number" id="dev-rate-input" value="90"
                                    class="mt-1 block w-full max-w-xs pl-3 pr-3 py-2 text-base border-slate-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                            </div>
                            <dl class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <dt class="text-slate-600">One-Time Dev Cost (~510 hrs)</dt>
                                    <dd id="dev-cost-total" class="font-semibold text-slate-900">$30,750</dd>
                                </div>
                                <div class="flex justify-between">
                                    <dt class="text-slate-600">Annual API Cost (Moderate Usage)</dt>
                                    <dd id="api-cost-annual" class="font-semibold text-slate-900">~$72</dd>
                                </div>
                                <div class="flex justify-between">
                                    <dt class="text-slate-600">Annual Infrastructure (DB + Hosting)</dt>
                                    <dd id="infra-cost-annual" class="font-semibold text-slate-900">$1,050 (Est.)</dd>
                                </div>
                                <div class="flex justify-between border-t pt-2 mt-2">
                                    <dt class="text-base font-bold text-slate-900">Total Estimated First-Year Cost</dt>
                                    <dd id="total-cost-first-year" class="text-base font-bold text-teal-600">$31,872
                                    </dd>
                                </div>
                            </dl>
                        </div>
                    </div>
                    <div class="chart-container h-64 md:h-80">
                        <canvas id="budget-chart"></canvas>
                    </div>
                </div>
            </div>
        </section>

    </main>
    <footer class="bg-white border-t border-slate-200 py-6 mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-slate-600">
                <p class="text-sm">
                    © 2025 University of Georgia College of Agricultural and Environmental Sciences
                </p>
                <p class="text-xs mt-1">
                    Site developed by Scott Allen CAES Web Team
                </p>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js failed to load');
                return;
            }

            let manuallySelectedProvider = null;

            const timelineData = [
                { phase: 1, title: 'Planning & Architecture', hours: 100, content: 'Defining the technical blueprint, selecting the technology stack, and designing the system architecture for security, scalability, and maintainability.' },
                { phase: 2, title: 'Conversation Design & UX', hours: 100, content: 'Crafting the user experience, defining the chatbot’s persona and tone, and mapping conversational flows to ensure natural, helpful interactions.' },
                { phase: 3, title: 'API & Integration Dev', hours: 50, content: 'Core back-end engineering to manage interactions with the LLM provider, handle API keys, and build the RAG retrieval pipeline.' },
                { phase: 4, title: 'Testing & Quality Assurance', hours: 100, content: 'Rigorous unit, integration, and user acceptance testing to ensure reliability, accuracy, and a high-quality user experience.' },
                { phase: 5, title: 'Deployment & Scaling', hours: 30, content: 'Moving the application to a live production environment on a cloud provider, configured for high availability and robust monitoring.' },
                { phase: 6, title: 'Multi-Channel Integration', hours: 50, content: 'Integrating the chatbot into user-facing channels, primarily a widget on the institution’s website, ensuring seamless cross-browser functionality.' },
            ];

            const teamData = [
                { role: 'Lead AI/ML Engineer', icon: '🧠', description: 'Provides technical leadership on LLM selection, prompt strategy, and RAG architecture.' },
                { role: 'Back-End Developer', icon: '⚙️', description: 'Builds the server-side logic, API integrations, and database connections.' },
                { role: 'Front-End Developer', icon: '🎨', description: 'Builds the interactive chat interface and connects it to the back-end application.' },
                { role: 'Business Analyst', icon: '📈', description: 'Curates the knowledge base, defines use cases, and validates response accuracy.' },
                { role: 'QA Tester', icon: '🧪', description: 'Executes systematic test plans to identify bugs and verify functionality.' },
            ];

            const models = {
                'gpt-4o-mini': { name: 'OpenAI GPT-4o-mini', input: 0.15, output: 0.60 },
                'gemini-1.5-flash': { name: 'Google Gemini 1.5 Flash', input: 0.075, output: 0.30 },
                'claude-3.5-sonnet': { name: 'Anthropic Claude 3.5 Sonnet', input: 3.00, output: 15.00 },
            };

            const timelineContainer = document.getElementById('timeline-container');
            timelineData.forEach(item => {
                const phaseElement = document.createElement('div');
                phaseElement.innerHTML = `
                    <button class="phase-header w-full flex justify-between items-center text-left p-4 bg-slate-50 rounded-lg hover:bg-slate-100 transition duration-200">
                        <span class="font-semibold text-slate-800">${item.phase}. ${item.title}</span>
                        <span class="text-sm font-medium text-teal-600">${item.hours} hrs</span>
                    </button>
                    <div class="phase-content bg-white text-slate-600 text-sm">
                        ${item.content}
                    </div>`;
                timelineContainer.appendChild(phaseElement);
            });

            timelineContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.phase-header');
                if (header) {
                    const content = header.nextElementSibling;
                    content.classList.toggle('open');
                }
            });

            const teamContainer = document.getElementById('team-container');
            teamData.forEach(member => {
                const card = document.createElement('div');
                card.className = 'bg-slate-50 p-4 rounded-lg text-center transform hover:-translate-y-1 transition-transform duration-300';
                card.innerHTML = `
                    <div class="text-4xl mb-2">${member.icon}</div>
                    <h4 class="font-semibold text-slate-800">${member.role}</h4>
                    <p class="text-xs text-slate-500 mt-1">${member.description}</p>`;
                teamContainer.appendChild(card);
            });

            const modelSelect = document.getElementById('model-select');
            Object.keys(models).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = models[key].name;
                if (key === 'gpt-4o-mini') option.selected = true;
                modelSelect.appendChild(option);
            });

            const visitorSlider = document.getElementById('visitor-slider');
            const engagementSlider = document.getElementById('engagement-slider');
            const visitorValue = document.getElementById('visitor-value');
            const engagementValue = document.getElementById('engagement-value');
            const monthlyCost = document.getElementById('monthly-cost');
            const devRateInput = document.getElementById('dev-rate-input');
            const devCostTotal = document.getElementById('dev-cost-total');
            const apiCostAnnual = document.getElementById('api-cost-annual');
            const infraCostAnnual = document.getElementById('infra-cost-annual');
            const totalCostFirstYear = document.getElementById('total-cost-first-year');
            const dbSizeSlider = document.getElementById('db-size-slider');
            const dbSizeValue = document.getElementById('db-size-value');
            const dbCostTable = document.getElementById('db-cost-table');
            const dbRecommendation = document.getElementById('db-recommendation');

            const costChartCtx = document.getElementById('cost-chart').getContext('2d');
            let costChart = new Chart(costChartCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Projected Monthly Cost ($)',
                        data: [],
                        backgroundColor: '#0d9488',
                        borderColor: '#047857',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, title: { display: true, text: 'Cost in USD ($)' } } },
                    plugins: {
                        legend: { display: false }, tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            const budgetChartCtx = document.getElementById('budget-chart').getContext('2d');
            let budgetChart = new Chart(budgetChartCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Development', 'API Usage', 'Infrastructure'],
                    datasets: [{
                        data: [30750, 72, 1050],
                        backgroundColor: ['#0f766e', '#14b8a6', '#99f6e4'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed !== null) {
                                        label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            function calculateApiCosts() {
                const selectedModelKey = modelSelect.value;
                const model = models[selectedModelKey];
                const dailyVisits = parseInt(visitorSlider.value);
                const engagementRate = parseInt(engagementSlider.value) / 100;

                const dailyQueries = dailyVisits * engagementRate;
                const tokensPerQuery = 2000;
                const monthlyTokens = dailyQueries * tokensPerQuery * 30;

                const inputTokenRatio = 0.25;  // 25% input tokens
                const outputTokenRatio = 0.75; // 75% output tokens

                const monthlyInputTokens = monthlyTokens * inputTokenRatio / 1000000; // per million tokens
                const monthlyOutputTokens = monthlyTokens * outputTokenRatio / 1000000; // per million tokens

                const cost = (monthlyInputTokens * model.input) + (monthlyOutputTokens * model.output);

                monthlyCost.textContent = `$${cost.toFixed(2)}`;
                apiCostAnnual.textContent = `~$${(cost * 12).toFixed(0)}`;

                updateCostChart(dailyVisits, engagementRate);
                updateBudget();
            }

            function linkifyAndMarkdown(text) {
                if (!text) return '';

                // First, decode any URL-encoded content
                try {
                    if (text.includes('%3C') || text.includes('%20')) {
                        text = decodeURIComponent(text);
                    }
                } catch (e) {
                    console.error('Decoding error:', e);
                }

                // Handle HTML entities
                text = text
                    .replace(/&lt;/g, '<')
                    .replace(/&gt;/g, '>')
                    .replace(/&quot;/g, '"')
                    .replace(/&#39;/g, "'")
                    .replace(/&amp;/g, '&');

                // Convert markdown bold to HTML
                text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

                // Convert numbered lists (must be at start of line)
                text = text.replace(/^(\d+)\.\s+(.+)$/gm, '<li>$2</li>');

                // Wrap consecutive <li> elements in <ol>
                text = text.replace(/(<li>.*<\/li>\s*)+/g, function (match) {
                    return '<ol>' + match + '</ol>';
                });

                // Convert bullet lists
                text = text.replace(/^[\*\-]\s+(.+)$/gm, '<li>$1</li>');

                // Wrap consecutive <li> elements that aren't already in lists
                text = text.replace(/(<li>.*<\/li>\s*)+/g, function (match) {
                    if (!match.includes('<ol>')) {
                        return '<ul>' + match + '</ul>';
                    }
                    return match;
                });

                // Remove any HTML tags that might have slipped through (except the ones we want)
                text = text.replace(
                    /<a\s+href=["']([^"']+)["'][^>]*>([^<]+)<\/a>/gi,
                    '[$2]($1)'
                );

                // Now process markdown links: [text](url)
                let processedText = text;
                const markdownLinks = [];

                // Extract all markdown links first to avoid double-processing
                processedText = processedText.replace(
                    /\[([^\]]+)\]\(([^)]+)\)/g,
                    (match, linkText, url) => {
                        const placeholder = `__MDLINK_${markdownLinks.length}__`;
                        markdownLinks.push({ text: linkText, url: url });
                        return placeholder;
                    }
                );

                // Process bare URLs that aren't already placeholders
                processedText = processedText.replace(
                    /(https?:\/\/[^\s<]+)/g,
                    (match) => {
                        if (match.includes('__MDLINK_')) return match;

                        if (match.includes('linkedin.com/in/')) {
                            const cleanUrl = match.replace(/[<>]/g, '');
                            const username = cleanUrl.split('/').pop().replace(/[?#].*$/, '');
                            const displayName = username.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" class="linkedin-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline; vertical-align: text-bottom; margin-right: 4px;">
                        <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                    </svg>${displayName}</a>`;
                        }

                        const cleanUrl = match.replace(/[<>]/g, '');
                        return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" class="text-teal-600 underline break-words">${cleanUrl}</a>`;
                    }
                );

                // Replace the placeholders with formatted links
                markdownLinks.forEach((link, index) => {
                    const placeholder = `__MDLINK_${index}__`;
                    let replacement;

                    if (link.url.includes('linkedin.com')) {
                        replacement = `<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="linkedin-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline; vertical-align: text-bottom; margin-right: 4px;">
                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                </svg>${link.text}</a>`;
                    } else {
                        replacement = `<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="text-teal-600 underline break-words">${link.text}</a>`;
                    }

                    processedText = processedText.replace(placeholder, replacement);
                });

                return processedText;
            }

            function updateCostChart(dailyVisits, engagementRate) {
                const labels = [];
                const data = [];
                Object.values(models).forEach(model => {
                    const dailyQueries = dailyVisits * engagementRate;
                    const monthlyTokens = dailyQueries * 2000 * 30;
                    const cost = ((monthlyTokens * 0.25 / 1000000) * model.input) + ((monthlyTokens * 0.75 / 1000000) * model.output);
                    labels.push(model.name.split(' ').slice(1).join(' ')); // Shorten label for chart
                    data.push(cost);
                });

                costChart.data.labels = labels;
                costChart.data.datasets[0].data = data;
                costChart.update();
            }

            function calculateDatabaseCosts() {
                const size = parseInt(dbSizeSlider.value);
                dbSizeValue.textContent = size;

                const providers = [
                    {
                        name: 'Pinecone',
                        calculate: (gb) => {
                            const cost = Math.max(50, gb * 0.33) * 12; // Example: $50/mo minimum or $0.33/GB/mo
                            return { cost: cost, justification: 'Based on $50/mo minimum or $0.33/GB/mo, whichever is higher.' };
                        }
                    },
                    {
                        name: 'Qdrant',
                        calculate: (gb) => {
                            const cost = (gb <= 1) ? 0 : (25 + (gb - 1) * 8) * 12; // Example: Free up to 1GB, then scales
                            return { cost: cost, justification: 'Free up to 1GB, then scales from a $25/mo base.' };
                        }
                    },
                    {
                        name: 'Weaviate',
                        calculate: (gb) => {
                            const cost = Math.max(25, (gb * 2000) * 0.095) * 12; // Example: $25/mo minimum or dimension-based cost
                            return { cost: cost, justification: 'Based on $25/mo minimum or dimension-based storage cost.' };
                        }
                    },
                    {
                        name: 'Azure AI Search',
                        calculate: (gb) => {
                            // Simplified tiers for example: Basic (15GB), S1 (160GB), S2 (500GB)
                            const cost = (gb <= 15) ? 74 * 12 : (gb <= 160) ? 246 * 12 : 981 * 12;
                            return { cost: cost, justification: 'Fixed annual cost based on provisioned tier (Basic, S1, etc.).' };
                        }
                    },
                    {
                        name: 'Vertex AI Vector Search',
                        calculate: (gb) => {
                            const cost = (68 + (gb * 1.5)) * 12; // Example: Fixed hourly node cost + storage scaling
                            return { cost: cost, justification: 'Based on fixed hourly node cost plus estimated storage scaling.' };
                        }
                    }
                ];

                let minCost = Infinity;
                let bestProvider = '';
                const costData = providers.map(p => {
                    const result = p.calculate(size);
                    if (result.cost < minCost) {
                        minCost = result.cost;
                        bestProvider = p.name;
                    }
                    return { name: p.name, ...result };
                });

                const providerToSelect = manuallySelectedProvider || bestProvider;

                dbCostTable.innerHTML = '';
                costData.forEach(data => {
                    const row = document.createElement('tr');
                    const isSelected = data.name === providerToSelect;

                    if (isSelected) {
                        row.className = 'bg-teal-50'; // Highlight selected row
                    }

                    row.innerHTML = `
                        <td class="px-6 py-4 text-center">
                            <input type="radio" name="db-provider-select" value="${data.name}" class="h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500" ${isSelected ? 'checked' : ''}>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap font-semibold ${isSelected ? 'text-teal-700' : 'text-slate-800'}">${data.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap font-semibold ${isSelected ? 'text-teal-700' : 'text-slate-700'}">~$${data.cost.toLocaleString()}</td>
                        <td class="px-6 py-4 text-slate-600">${data.justification}</td>
                    `;
                    dbCostTable.appendChild(row);
                });

                dbRecommendation.innerHTML = `<h4 class="font-bold mb-2">Recommendation for ${size}GB</h4><p class="text-sm md:text-base">At this scale, <strong>${bestProvider}</strong> is the most cost-effective option. You have currently selected <strong>${providerToSelect}</strong> for budget calculation. The optimal choice depends on the trade-offs between pure cost, ecosystem alignment, and specific feature requirements.</p>`;

                updateBudget();
            }

            function getSelectedDbCost() {
                const selectedProviderName = document.querySelector('input[name="db-provider-select"]:checked')?.value;
                if (!selectedProviderName) return 0;

                const size = parseInt(dbSizeSlider.value);
                const providers = [
                    { name: 'Pinecone', calculate: (gb) => Math.max(50, gb * 0.33) * 12 },
                    { name: 'Qdrant', calculate: (gb) => (gb <= 1) ? 0 : (25 + (gb - 1) * 8) * 12 },
                    { name: 'Weaviate', calculate: (gb) => Math.max(25, (gb * 2000) * 0.095) * 12 },
                    { name: 'Azure AI Search', calculate: (gb) => (gb <= 15) ? 74 * 12 : (gb <= 160) ? 246 * 12 : 981 * 12 },
                    { name: 'Vertex AI Vector Search', calculate: (gb) => (68 + (gb * 1.5)) * 12 }
                ];

                const provider = providers.find(p => p.name === selectedProviderName);
                return provider ? provider.calculate(size) : 0;
            }

            function updateBudget() {
                const devRate = parseFloat(devRateInput.value) || 0;
                const devCost = 510 * devRate;
                const apiCost = parseFloat(apiCostAnnual.textContent.replace(/[^0-9.-]+/g, ""));
                const dbCost = getSelectedDbCost();
                const hostingCost = 450; // Example annual hosting cost
                const infraCost = dbCost + hostingCost;

                devCostTotal.textContent = `$${devCost.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
                infraCostAnnual.textContent = `~$${Math.round(infraCost).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} (Est.)`;
                const totalCost = devCost + apiCost + infraCost;
                totalCostFirstYear.textContent = `$${Math.round(totalCost).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;

                budgetChart.data.datasets[0].data = [devCost, apiCost, infraCost];
                budgetChart.update();
            }

            visitorSlider.addEventListener('input', () => {
                visitorValue.textContent = visitorSlider.value;
                calculateApiCosts();
            });

            engagementSlider.addEventListener('input', () => {
                engagementValue.textContent = `${engagementSlider.value}%`;
                calculateApiCosts();
            });

            modelSelect.addEventListener('change', calculateApiCosts);
            devRateInput.addEventListener('input', updateBudget);

            dbSizeSlider.addEventListener('input', () => {
                manuallySelectedProvider = null; // Reset selection when slider changes
                calculateDatabaseCosts();
            });

            dbCostTable.addEventListener('change', (e) => {
                if (e.target.name === 'db-provider-select') {
                    manuallySelectedProvider = e.target.value;
                    calculateDatabaseCosts(); // Rerun to update highlighting and recommendation
                }
            });

            // Smooth scrolling for navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    // Adjust offset to trigger active state slightly before section reaches top
                    if (window.pageYOffset >= sectionTop - 80) {
                        current = section.getAttribute('id');
                    }
                });
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').substring(1) === current) {
                        link.classList.add('active');
                    }
                });
            });

            // Initial calculations on page load
            calculateApiCosts();
            calculateDatabaseCosts();

            // ---------- CHAT WIDGET ----------
            const msgs = document.getElementById('hfim-msgs');
            const input = document.getElementById('hfim-input');
            const sendBtn = document.getElementById('hfim-send');

            function addMsg(text, cls) {
                const msgDiv = document.createElement('div');
                msgDiv.className = 'hfim-msg ' + cls;

                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.innerHTML = linkifyAndMarkdown(text);

                msgDiv.appendChild(bubble);
                msgs.appendChild(msgDiv);
                msgs.scrollTop = msgs.scrollHeight;
            }

            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typing-indicator';

                // Create three dots
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('span');
                    typingDiv.appendChild(dot);
                }

                msgs.appendChild(typingDiv);
                msgs.scrollTop = msgs.scrollHeight;
            }

            function hideTypingIndicator() {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }


            function addSources(sources, linkedInProfiles) {
                if ((!sources || !sources.length) && (!linkedInProfiles || !linkedInProfiles.length)) return;

                const details = document.createElement('details');
                details.className = 'hfim-msg bot';
                details.style.marginTop = '8px';

                const summary = document.createElement('summary');
                summary.style.cursor = 'pointer';
                summary.style.fontWeight = '500';
                summary.textContent = linkedInProfiles?.length ?
                    `Show sources & ${linkedInProfiles.length} LinkedIn profiles` :
                    'Show sources';
                details.appendChild(summary);

                const content = document.createElement('div');
                content.style.marginTop = '8px';

                // Add LinkedIn profiles if available
                if (linkedInProfiles && linkedInProfiles.length > 0) {
                    const profileSection = document.createElement('div');
                    profileSection.innerHTML = '<strong>LinkedIn Profiles Found:</strong>';
                    profileSection.style.marginBottom = '8px';

                    const profileList = document.createElement('ul');
                    profileList.style.marginLeft = '1rem';
                    profileList.style.listStyleType = 'none';

                    linkedInProfiles.forEach(profile => {
                        const li = document.createElement('li');
                        li.style.marginBottom = '4px';
                        li.innerHTML = `
                <a href="${profile.url}" target="_blank" rel="noopener noreferrer" class="linkedin-link" style="display: inline-flex; align-items: center;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#0077B5" style="margin-right: 8px;">
                        <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                    </svg>
                    ${profile.text || profile.url.split('/').pop().replace(/-/g, ' ')}
                </a>`;
                        profileList.appendChild(li);
                    });

                    profileSection.appendChild(profileList);
                    content.appendChild(profileSection);
                }

                // Add regular sources
                if (sources && sources.length > 0) {
                    const sourceSection = document.createElement('div');
                    sourceSection.innerHTML = '<strong>Sources:</strong>';

                    const ul = document.createElement('ul');
                    ul.style.marginLeft = '1rem';

                    sources.forEach(s => {
                        const li = document.createElement('li');
                        if (s.url) {
                            li.innerHTML = `<a href="${s.url}" target="_blank" rel="noopener noreferrer" class="text-teal-600 underline break-words">${s.url}</a>`;
                            if (s.hasLinkedIn) {
                                li.innerHTML += ' <span style="color: #0077B5; font-size: 0.875rem;">(contains LinkedIn profiles)</span>';
                            }
                        } else {
                            li.textContent = s.sourceFile || 'Unknown source';
                        }
                        ul.appendChild(li);
                    });

                    sourceSection.appendChild(ul);
                    content.appendChild(sourceSection);
                }

                details.appendChild(content);
                msgs.appendChild(details);
                msgs.scrollTop = msgs.scrollHeight;
            }

            async function sendMessage() {
                const text = input.value.trim();
                if (!text) return;
                addMsg(text, 'user');
                input.value = '';

                // Show typing indicator
                showTypingIndicator();

                try {
                    const resp = await fetch(window.API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': window.API_KEY
                        },
                        body: JSON.stringify({ message: text })
                    });
                    const data = await resp.json();

                    // Hide typing indicator before showing response
                    hideTypingIndicator();

                    // Display the answer with properly formatted links
                    addMsg(data.answer || 'No answer', 'bot');

                    // Display sources and LinkedIn profiles
                    addSources(data.sources, data.linkedInProfiles);
                } catch (e) {
                    hideTypingIndicator();
                    addMsg('Error: ' + e.message, 'bot');
                }
            }
            const style = document.createElement('style');
            style.textContent = `
    .linkedin-link {
        color: #0077B5;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: opacity 0.2s;
    }
    .linkedin-link:hover {
        opacity: 0.8;
        text-decoration: underline;
    }
`;
            document.head.appendChild(style);

            if (sendBtn) sendBtn.addEventListener('click', sendMessage);
            if (input) input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });

        });
    </script>

</body>

</html>